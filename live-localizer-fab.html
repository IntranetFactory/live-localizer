<!--
@license https://github.com/t2ym/live-localizer/blob/master/LICENSE.md
Copyright (c) 2016, Tetsuya Mori <t2y3141592@gmail.com>. All rights reserved.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-overlay-behavior/iron-overlay-behavior.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../paper-fab/paper-fab.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../neon-animation/animations/fade-out-animation.html">
<link rel="import" href="draggable-behavior.html">

<dom-module id="live-localizer-fab">
  <template>
    <style>
      :host {
        display: block;
        position: fixed;
      }
      paper-fab.label {
        padding-bottom: 6px;
        padding-top: 6px;
        --paper-fab-background: lightgrey;
        --paper-fab-keyboard-focus-background: slategrey;
        --paper-fab-iron-icon: {
          color: slategrey;
          width: 32px;
          height: 32px;
        }
      }
      paper-fab.closed {
        visibility: hidden;
      }
    </style>
    <paper-fab id="fab" class="label" icon="language" title="Live Localizer"></paper-fab>
  </template>
  <script>
    Polymer({

      is: 'live-localizer-fab',

      behaviors: [
        Polymer.IronOverlayBehaviorImpl,
        Polymer.NeonAnimationRunnerBehavior,
        BehaviorsStore.DraggableBehavior
      ],

      properties: {
        animationConfig: {
          type: Object,
          value: function() {
            return {
              'entry': [{
                name: 'fade-in-animation',
                node: this
              }],
              'exit': [{
                name: 'fade-out-animation',
                node: this
              }]
            };
          }
        },

        noCancelOnEscKey: {
          type: Boolean,
          value: true
        },

        noCancelOnOutsideClick: {
          type: Boolean,
          value: true
        }
      },

      listeners: {
        'neon-animation-finish': '_onNeonAnimationFinish'
      },

      attached: function () {
        this.resetPosition();
      },

      resetPosition: function () {
        if (!this.shown) {
          var fullWidth = window.innerWidth;
          var fullHeight = window.innerHeight;
          this.x = 56;
          this.y = fullHeight - 56 - 56;
        }
      },

      _renderOpened: function() {
        this.cancelAnimation();
        this.$.fab.classList.remove('closed');
        this.playAnimation('entry');
      },

      _renderClosed: function() {
        this.cancelAnimation();
        this.playAnimation('exit');
      },

      _onNeonAnimationFinish: function() {
        if (this.opened) {
          this._finishRenderOpened();
          this.shown = true;
        } else {
          this.$.fab.classList.add('closed');
          this._finishRenderClosed();
        }
      },

      refit: Function(),

      notifyResize: Function()
    });
  </script>
</dom-module>
